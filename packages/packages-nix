#need to run as root

cd /tmp
rm install
wget https://nixos.org/nix/install
chmod +x install

rm -rf /nix/*

USER=root ./install --no-daemon
rm install

. ~/.nix-profile/etc/profile.d/nix.sh

# switch to stable channel
#nix-channel --remove nixpkgs
#nix-channel --add https://nixos.org/channels/nixos-21.05 nixpkgs

nix-channel --update

# nix-env --install ripgrep-all swtpm

# NIXPKGS_ALLOW_UNFREE=1 nix-env --install vscode

# packages of interest
# go google-chrome thunderbird kubernetes micro rclone bitwarden-cli apfs-fuse-unstable

# nix-env -u

nix-collect-garbage -d

nix-store --verify --check-contents
nix-store --gc
nix-store --optimise

wget https://github.com/phiresky/ripgrep-all/releases/download/v0.9.6/ripgrep_all-v0.9.6-x86_64-unknown-linux-musl.tar.gz
gzip -d ripgrep_all-*
tar -xvf ripgrep_all-*
mv ripgrep_all-*/rga /usr/local/bin/

curl https://getmic.ro | bash
mv micro /usr/local/bin/

# bitwarden
curl -L 'https://vault.bitwarden.com/download/?app=cli&platform=linux' > bw.zip
unzip bw.zip
rm bw.zip
chmod +x bw
mv bw /usr/local/bin/

# appimage
wget https://download.kde.org/stable/digikam/7.3.0/digiKam-7.3.0-x86-64.appimage -O /usr/local/bin/digikam
chmod +x /usr/local/bin/digikam

# pip
curl --silent --show-error https://bootstrap.pypa.io/get-pip.py | sudo python3

pip3 install awscli PyYAML
pip3 install pyusb temperusb
pip3 install castero
pip3 install networkx

# Try both wget first
if ! [ -f usr/local/bin/pacapt ]; then
  wget --no-check-certificate https://raw.githubusercontent.com/icy/pacapt/ng/pacapt -O /usr/local/bin/pacapt
  chmod 755 /usr/local/bin/pacapt
fi
