# Fast boot - set timeout to 1 sec
set timeout=1
set gfxpayload=keep

source /dotfiles/boot/grub-live.cfg

MODULES="module_blacklist=nouveau"
OVERRIDE="acpi_enforce_resources=lax"

menuentry linux_bestia {
  # root from backup drive (linux_bestia)
  linux /kernel/vmlinuz $DEFAULT $RDEXEC $MODULES $SERVICES $OVERRIDE root=LABEL=linux_bestia
  initrd /kernel/initrd.img
}

menuentry bestia {
  # EFI from backup drive (EFI_BESTIA)
  insmod configfile
  search --no-floppy --set root_bestia --label EFI_BESTIA
  set root=$root_bestia
  set prefix=($root)/grub
  configfile /grub/grub.cfg
}

# Dev
menuentry linux_dev {
  linux /kernel/vmlinuz $DEFAULT $RDEXEC $MODULES $SERVICES $OVERRIDE rootflags=subvol=linux-dev
  initrd /kernel/initrd.img
}

menuentry ipxe {
    linux16 /ipxe.lkrn
}

menuentry nfs {
  linux /kernel/vmlinuz root=/dev/nfs nfsroot=192.168.1.2:/run/media/linux/linux ro net.ifnames=0 $OVERRIDE ip=192.168.1.3::192.168.1.1:255.255.255.0:bestia:eth0:off systemd.wants=ssh-keygen rd.neednet=1
  initrd /kernel/initrd-nfs.img
}

menuentry squashfs {
  linux /kernel/vmlinuz root=live:http://192.168.1.2/kucko.img ro rd.live.image rd.lvm=0 rd.luks=0 rd.md=0 rd.dm=0 rd.neednet=1 ip=dhcp
  initrd /kernel/initrd.img
}

# ip=dhcp
# overlayroot="tmpfs"
# ip=192.168.1.3::192.168.1.1:24:bestia:eth0:none
# systemd.volatile=state
# rd.debug rd.break
