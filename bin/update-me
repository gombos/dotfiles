cd $DOTFILES/ && git pull

# for pincer
mnt efi && cd $MNTDIR/efi/dotfiles && git pull

# for bestia
mnt-efi_bestia && cd $MNTDIR/efi_bestia/dotfiles && git pull

infra-provision-mac

# pip
python3 -m pip install --upgrade pip
pip3 list --user --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1 | xargs -n1 pip3 install -U 2>/dev/null

# brew
if [ -n "$HOMEBREW_PREFIX" ]; then
  brew update
  brew upgrade
  brew cleanup --prune=all
  brew doctor
fi

brew install fio micro rclone ripgrep ripgrep-all

#nix
$DOTFILES/packages/packages-nix

# docker
sudo docker images |grep -v REPOSITORY|awk '{print $1}'|xargs -L1 sudo docker pull
sudo docker ps -q | xargs sudo docker restart

cd $DOTFILES/infra
sudo docker-compose up -d --force-recreate --remove-orphans

# aws
if [ -L /dev/disk/by-label/cloudimg-rootfs ]; then
  sudo DEBIAN_FRONTEND=noninteractive apt-get update -y -qq -o Dpkg::Use-Pty=0
  sudo DEBIAN_FRONTEND=noninteractive apt-get upgrade -y -qq -o Dpkg::Use-Pty=0
fi
