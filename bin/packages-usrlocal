#!/bin/sh

set -x

cd /tmp

. ./infra-env.sh

mkdir -p /usr/local/bin

# todo - separate out nix to its own script
#

#mkdir -p /nix
#rm -rf /nix/*

# populate /nix and /nix/var/nix/profiles/default/ so that it is usrlocal compatible
#echo "nixbld:x:402:nobody" >> /etc/group
#rm -rf install
#wget --quiet https://nixos.org/nix/install
#chmod +x install
#USER=root ./install --no-daemon
#. /root/.nix-profile/etc/profile.d/nix.sh
#rm -rf install

#nix-channel --update

# NIXPKGS_ALLOW_UNFREE=1 nix-env --install vscode

# packages of interest
# go google-chrome thunderbird kubernetes micro rclone bitwarden-cli apfs-fuse-unstable

#fixme nix-collect-garbage -d
#fixme nix-store --verify --check-contents
#fixme nix-store --gc
#fixme nix-store --optimise
#fixme sudo chown root:root /nix/store

# rga
rm -rf ripgrep_all-*
wget --quiet https://github.com/phiresky/ripgrep-all/releases/download/v${RIPGREP}/ripgrep_all-v${RIPGREP}-x86_64-unknown-linux-musl.tar.gz
gzip -d ripgrep_all-*
tar -xvf ripgrep_all-*
mv ripgrep_all-*/rga* /usr/local/bin/
rm -rf ripgrep_all-*

# micro
wget --quiet -O - https://getmic.ro | GETMICRO_REGISTER=y sh
mv micro /usr/local/bin/

# rclone
#rm -rf rclone-*-linux-amd64.zip
#wget --quiet https://github.com/rclone/rclone/releases/download/v${RCLONE}/rclone-v${RCLONE}-linux-amd64.zip
#unzip rclone-*-linux-amd64.zip
#mv rclone-*/rclone /usr/local/bin/
#rm -rf rclone-*

# bitwarden
wget --quiet -O - https://github.com/bitwarden/clients/releases/download/cli-v${BW}/bw-linux-${BW}.zip > bw.zip
unzip bw.zip
rm bw.zip
chmod +x bw
mv bw /usr/local/bin/

# appimage - digikam
wget --quiet https://download.kde.org/stable/digikam/${DIGIKAM}/digiKam-${DIGIKAM}-x86-64.appimage -O /usr/local/bin/digikam
chmod +x /usr/local/bin/digikam

# appimage - chrome
# pkg2appimage depends on dpkg
#rm -rf out google-chrome chrome.yml
#wget --quiet -c "https://github.com/AppImage/pkg2appimage/raw/master/pkg2appimage"
#wget --quiet https://raw.githubusercontent.com/gombos/dotfiles/main/infra/chrome.yml
#bash -ex pkg2appimage chrome.yml
#mv out/*.AppImage /usr/local/bin/google-chrome-stable
#rm -rf out google-chrome chrome.yml

# distrobox
#wget -qO- https://raw.githubusercontent.com/89luca89/distrobox/main/install | sudo sh

# pip
wget --quiet -O - https://bootstrap.pypa.io/get-pip.py | python3

pip3 install castero
pip3 install linode-cli

# dev tools
# pip3 install networkx
# pip3 install python-apt
# pip3 install awscli PyYAML
# pip3 install pyusb temperusb

sudo chown -R root:root /usr/local/bin/

find /usr/local
