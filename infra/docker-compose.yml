version: '3.3'

services:
#  watchtower:
#    container_name: watchtower
#    image: containrrr/watchtower
#    volumes:
#      - /var/run/docker.sock:/var/run/docker.sock
#    command: --interval "3600" --cleanup
#    restart: always

  nginx:
    container_name: nginx
    image: nginx
    restart: always
    ports:
      -  80:80
      - 443:443

    volumes:
      - /home/www:/usr/share/nginx/html
      - ./nginx.conf:/etc/nginx/nginx.conf
      - /run/media/letsencrypt:/etc/letsencrypt
      # Required during certificate renewal
      - /run/media/letsencrypt/www:/var/www/certbot

  # meant to run as a batch job to renew certificates
  certbot:
    image: certbot/certbot
    # Renew certificate every 12 hours as recommended by Letâ€™s Encrypt
#    entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h & wait $${!}; done;'"
    volumes:
      - /run/media/letsencrypt:/etc/letsencrypt
      - /run/media/letsencrypt/www:/var/www/certbot

#services:
#  mailserver:
#    image: docker.io/mailserver/docker-mailserver:latest
#    hostname: <HOSTNAME> # <-- CHANGE THIS
#    domainname: <DOMAINNAME> # <-- CHANGE THIS
#    container_name: mailserver
##    env_file: mailserver.env
#    # To avoid conflicts with yaml base-60 float, DO NOT remove the quotation marks.
#    # More information about the mailserver ports:
#    # https://docker-mailserver.github.io/docker-mailserver/edge/config/security/understanding-the-ports/
#    ports:
#      - "25:25"    # SMTP  (explicit TLS => STARTTLS)
#      - "143:143"  # IMAP4 (explicit TLS => STARTTLS)
#      - "465:465"  # ESMTP (implicit TLS)
#      - "587:587"  # ESMTP (explicit TLS => STARTTLS)
#      - "993:993"  # IMAP4 (implicit TLS)
#    volumes:
#      - maildata:/var/mail
#      - mailstate:/var/mail-state
#      - maillogs:/var/log/mail
#      - /etc/localtime:/etc/localtime:ro
#      - ./config/:/tmp/docker-mailserver/
#    restart: always
#    stop_grace_period: 1m
#    cap_add: [ "NET_ADMIN", "SYS_PTRACE" ]
#
#volumes:
#  maildata:
#  mailstate:
#  maillogs:
